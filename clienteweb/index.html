<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tienda de Libros</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link href="css/bootstrap-datepicker.standalone.min.css" rel="stylesheet">
   </head>
<body>
    <div class="container-fluid">

        <div class="container text-center mt-5 pb-2">
            <h1 class="mt-4 mb-4 text-center">Tienda de Libros</h1>
            <div class="container mb-2 text-center">
                <a href="gestionarLibros.html" class="mr-3"><i class="far fa-address-book"></i> Gestionar Libros</a> |
                <a href="gestionarAutores.html" class="ml-3"><i class="fas fa-user"></i> Gestionar Autores</a>
            </div>
        </div>

        <div class="container row">
            <!--
            Buscador
            -->
            <div class="form-group col-md-2">
            </div>

            <div class="form-group col-md-3">
                <label for="txtNombreLibro">Nombre del Libro:</label>
                <input type="text" class="form-control" id="txtNombreLibro" required>
            </div>

            <div class="form-group col-md-3">
            </div>

            <div class="form-group col-md-4">
                <label for="cmbAutor">Autor:</label>
                <select id="cmbAutor" class="form-control" required></select>
            </div>

            <div class="form-group col-md-2">
            </div>
            <div class="form-group col-md-3 text-right">
                <button id="btnBuscarLibro" class="btn btn-info btn-enlinea"><i class="fas fa-search"></i>Buscar</button>
            </div>
            <div class="form-group col-md-3">
            </div>
            <div class="form-group col-md-4 text-right">
                <button id="btnBuscarAutor" class="btn btn-info btn-enlinea"><i class="fas fa-search"></i> Buscar</button>
            </div>

            <!--
            Buscador
            -->

        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/handlebars.min-v4.0.11.js"></script>
    <script src="js/sweetalert2.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script>

        (function () {

         /*   $('#btnLimpiar').on('click', limpiarFormulario);

            $('#btnCerrar').on('click', cerrarFormulario);*/

            $('#btnBuscarLibro').on('click', function () {
                var nombre = $('#txtNombreLibro') ;
                if (nombre.val().trim().length === 0){
                    nombre.addClass('is-invalid').removeClass('is-valid');
                    swal({
                        title:'Error de validación',
                        html: '<p class="text-left">Debe diligenciar el <b> Nombre del Libro</b>. <br/></p>',
                        type: 'warning'
                    });
                    return;
                }
                $.ajax({
                    url:'http://localhost:5000/libros/buscar/' + nombre.val(),
                    type:'GET',
                    dataType:'json',
                    success:function(resultado){
                        console.log(resultado.data);
                        //mostrarDetalleAutor(resultado.data);
                    },
                    error:function (err) {
                        console.error(err);
                    }
                });
            });

            $('#btnBuscarAutor').on('click', function () {
                var autor = $('#cmbAutor') ;
                if (autor.val() === '-1'){
                    autor.addClass('is-invalid').removeClass('is-valid');
                    swal({
                        title:'Error de validación',
                        html: '<p class="text-left">Debe Elegir <b> Un Autor</b>. <br/></p>',
                        type: 'warning'
                    });
                    return;
                }
                $.ajax({
                    url:'http://localhost:5000/libros/autor/' + autor.val(),
                    type:'GET',
                    dataType:'json',
                    success:function(resultado){
                        console.log(resultado.data);
                        //mostrarDetalleAutor(resultado.data);
                    },
                    error:function (err) {
                        console.error(err);
                    }
                });
            });

            $('#txtFechaPublicacion').datepicker();

            /* $.ajax({
                 url:'http://localhost:5000/libros/consultar',
                 type:'GET',
                 dataType:'json',
                 success:function(resultado){
                     console.log(resultado);
                 },
                 error:function (err) {
                     console.error(err);
                 }
             });*/

            $.ajax({
                url:'http://localhost:5000/autores/consultar',
                type:'GET',
                dataType:'json',
                success:function(resultado){
                    console.log(resultado);
                    //console.log(resultado.data);
                    var autores = resultado.data;
                    $('#cmbAutor').llenarCombo(autores, 'nombre', '_id');
                },
                error:function (err) {
                    console.error(err);
                }
            });

            //consultarLibros() ;

        })();

        function mostrarDetalleLibro (libro) {

            var bodyModal = $('#detalleLibroModal') ;

            bodyModal.find('#txtMosNombreLibro').val(libro.nombre);
            bodyModal.find('#txtMosAutor').val(libro.autor.nombre);
            bodyModal.find('#txtMosPrecio').val(libro.precio);
            bodyModal.find('#txtMosFechaPublicacion').val(libro.fecha_publicacion);
            bodyModal.find('#txtMosPortada').val(libro.portada);
            bodyModal.find('#txtMosEditorial').val(libro.editorial);
            bodyModal.find('#txtMosPrologo').text(libro.prologo);

            bodyModal.modal('show') ;
        }


      /*  function consultarLibros(){

            $.ajax({
                url:'http://localhost:5000/libros/consultar',
                type:'GET',
                dataType:'json',
                success:function(resultado){
                    cargarLibros(resultado.data) ;
                    //console.error(resultado);
                },
                error:function (err) {
                    console.error(err);
                }
            });

        }*/

        function limpiarFormulario(){
            var formulario = $('#GuardarLibroModal');
            formulario.find('input[type="text"], textarea, input[type="email"]').val('');
            formulario.find('select').val('-1');
            formulario.find('.is-valid , .is-invalid').removeClass('is-invalid').removeClass('is-valid') ;
        }

        function cerrarFormulario(){
            var bodyModalGuardar = $('#GuardarLibroModal') ;
            bodyModalGuardar.modal('hide') ;
            consultarLibros();
        }

        function mostrarMensajeSinDatos(){
            console.log('No hay registros');
        }

    </script>




</body>
</html>